- Q:Alter table 命令支持修改的内容
Alter table:只支持:1.`Alter table tableName Rename TO newName`:修改表名字。 2.`Alter table tableName Rename Column oldColumName TO NewColumnName`.:修改字段名 3.`ALTER TABLE  tableName add column xxx`:增加表字段 4.`ALTER TABLE  tableName Drop Column columnName`:删除表字段（存在主键/唯一键/索引等约束关系时可能删不掉）（#TODO官方文档支持，测试过不支持 - -！）。

```text
1. ALTER TABLE user_account RENAME to 'sss';
2. ALTER TABLE sss  add COLUMN new2;
3. ALTER TABLE sss  add COLUMN new2;
```

- Q:sqlite + alembic 版本管理时.修改字段属性/增加约束关系迁移失败
由于SQLite的alter table 语句不支持去修改字段的属性(比如默认值)/增加字段的约束关系。官方建议是采取`copy and move`的方式。就是先rename旧的表，然后新建一个一样结构的新表(同时增加对应的约束关系).然后把旧表的数据导入到新表.需要手动修改迁移文件：    

```python

"""empty message

Revision ID: 0f5f60fdb2f8
Revises: 71c2b17cd2a0
Create Date: 2022-05-23 09:45:17.127826

"""
from alembic import op
import sqlalchemy as sa

# revision identifiers, used by Alembic.
revision = '0f5f60fdb2f8'
down_revision = '71c2b17cd2a0'
branch_labels = None
depends_on = None


def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    ## 会采取 “copy and move”的策略
    with op.batch_alter_table("user_account") as batch_op:
        batch_op.create_unique_constraint("user_name_unique", ['name'])
    # ### end Alembic commands ###


def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    ## 会采取 “copy and move”的策略，否则会抛出sqlite语法错误
    with op.batch_alter_table("user_account") as batch_op:
        batch_op.drop_constraint('user_name_unique', type_='unique')
    # ### end Alembic commands ###

### 对应的SQL语句
#### 在原有表的基础加入新的约束关系/字段属性 创建一个新的表
CREATE TABLE _alembic_batch_temp (
    ## 旧的建表语句+新的字段属性
);
#### 把旧的数据从旧的表移动到新的表
INSERT INTO _alembic_batch_temp (id) SELECT some_table.id FROM some_table;
#### 把旧的表删除
DROP TABLE some_table;
#### 把新的表改名为旧的表
ALTER TABLE _alembic_batch_temp RENAME TO some_table;


```

